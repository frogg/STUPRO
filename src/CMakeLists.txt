cmake_minimum_required(VERSION 2.8.8 FATAL_ERROR)

# find pthread (C++11 threading) library and headers
find_package(Threads REQUIRED)

# find ParaView headers and libraries
find_package(ParaView REQUIRED)
include(${PARAVIEW_USE_FILE})
include(ParaViewBranding)

# to wrap the ui-files
find_package(Qt4 REQUIRED)
include(${QT_USE_FILE})

# automatically wrap *.ui files and classes inheriting from QObject
set(CMAKE_AUTOUIC TRUE)
set(CMAKE_AUTOMOC TRUE)

# source files responsible for creating the ParaView window
set(ParaView_SOURCE_FILES
    ${CMAKE_CURRENT_SOURCE_DIR}/StuproWindow.cpp
    ${CMAKE_CURRENT_SOURCE_DIR}/StuproWindow.hpp
)

# all other Kronos source files
file(GLOB StuproView_SOURCE_FILES
    "${CMAKE_CURRENT_SOURCE_DIR}/**/*.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/**/*.hpp"
)

# do the ui-file wrapping
QT4_WRAP_UI(UISrcs StuproWindow.ui)
#QT4_WRAP_CPP(MOCSrcs StuproWindow.hpp)

# directories to include (important for auto-generated code)
include_directories(
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/StuproView/
)

# register a ParaView plugin
add_paraview_plugin(
    StuproViewPlugin
    "1.0.0"
    REQUIRED_ON_SERVER
    REQUIRED_ON_CLIENT
    SERVER_MANAGER_SOURCES
        StuproView/vtkPVStuproView.cxx
    SERVER_MANAGER_XML
        StuproView/StuproView.xml
    SOURCES
        ${StuproView_SOURCE_FILES}
)

# use C++11 to compile the plugin
set_property(TARGET StuproViewPlugin PROPERTY CXX_STANDARD 11)

# register a ParaView client
build_paraview_client(
    paraview_stupro
    TITLE "ParaView - Kronos-Edition"
    ORGANIZATION "Kitware Inc."
    VERSION_MAJOR 1
    VERSION_MINOR 0
    VERSION_PATCH 0
    PVMAIN_WINDOW StuproWindow
    PVMAIN_WINDOW_INCLUDE StuproWindow.hpp
    REQUIRED_PLUGINS StuproViewPlugin
	SOURCES ${ParaView_SOURCE_FILES} ${MOCSrcs} ${UISrcs}
)

# use C++11 to compile the client
set_property(TARGET paraview_stupro PROPERTY CXX_STANDARD 11)

# copy over all required resources
file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/../res DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
